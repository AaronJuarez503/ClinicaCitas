<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title layout:title-pattern="$CONTENT_TITLE - Sistema de citas para clinicas">Sistema de citas para clinicas</title>
        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />

        <!-- Font Awesome para los iconos -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

        <!-- Tu archivo CSS personalizado -->
        <link th:href="@{/css/styles.css}" rel="stylesheet"/>

        <!-- Importante: Asegúrate de que no haya NINGÚN otro link a Bootstrap CSS aquí.
             Si ves una línea como <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
             DEBES ELIMINARLA para evitar conflictos. -->

        <!-- SweetAlert2 JS -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </head>
    <body>
        <div id="wrapper">

            <!-- Sidebar (Menú lateral) -->
            <div id="sidebar-wrapper">
                <div class="sidebar-heading-container">
                    <!-- El botón de toggle ahora está aquí, dentro del encabezado del sidebar -->
                    <button class="sidebar-toggle-button" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <span class="sidebar-title">Citas Clínicas</span>
                </div>
                <div class="list-group list-group-flush">

                  <div sec:authorize="isAuthenticated()">

                        <a th:href="@{/}" class="list-group-item">
                            <i class="fas fa-home"></i> Inicio
                        </a>


                        <!-- Médicos y Pacientes pueden reservar citas -->
                        <a th:href="@{/cita/create}" class="list-group-item"
                        sec:authorize="hasAnyAuthority('paciente')">
                            <i class="fas fa-calendar-plus"></i> Reservar Cita
                        </a>

                        <!-- Médicos y Pacientes pueden ver citas -->
                        <a th:href="@{/cita}" class="list-group-item"
                        sec:authorize="hasAnyAuthority('medico','paciente')">
                            <i class="fas fa-calendar-alt"></i> Ver Citas
                        </a>

                        <!-- Médicos y Pacientes pueden ver clínicas -->
                        <a th:href="@{/clinica}" class="list-group-item"
                        sec:authorize="hasAnyAuthority('medico','paciente')">
                            <i class="fas fa-hospital"></i> Ver Clínicas
                        </a>

                        <!-- Solo Paciente puede ver listado de médicos -->
                        <a th:href="@{/medico}" class="list-group-item"
                        sec:authorize="hasAuthority('paciente')">
                            <i class="fas fa-user-md"></i> Ver Médicos
                        </a>

                        <!-- Solo Médico puede ver listado de pacientes -->
                        <a th:href="@{/paciente}" class="list-group-item"
                        sec:authorize="hasAuthority('medico')">
                            <i class="fas fa-users"></i> Ver Pacientes
                        </a>

                        <a th:href="@{/logout}" class="list-group-item sidebar-settings-item">
                            <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                        </a>

                    </div>

                   <div sec:authorize="isAuthenticated()" class="sidebar-user">
                        <span style="font-weight: bold;">Usuario : </span>
                        <span class="text-light" sec:authentication="name"></span>
                    </div>

                    <div sec:authorize="isAnonymous()"      >
                        <a th:href="@{/login}" class="list-group-item sidebar-settings-item"><i class="fas fa-cog"></i> Iniciar Secion</a>
                    </div>
                </div>
            </div>
            <!-- /#sidebar-wrapper -->

            <!-- Contenido principal de la página. Ocupa el espacio restante y se ajusta al sidebar. -->
            <div id="page-content-wrapper">
                <div class="container-fluid">
                   <div layout:fragment="content">
                        <!-- Este es el espacio para el contenido específico de cada vista de Thymeleaf -->
                        <p>Contenido principal de la página...</p>
                   </div>
                </div>
            </div>
            <!-- /#page-content-wrapper -->
        </div>
        <!-- /#wrapper -->

        <!-- JavaScript para el toggle del sidebar. Los console.log ayudan a depurar. -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const wrapper = document.getElementById('wrapper');
                const sidebarToggle = document.getElementById('sidebarToggle');

                // Función para alternar la clase 'toggled' en el wrapper
                function toggleSidebar() {
                    console.log("Toggle sidebar clicado. Estado actual del wrapper.classList:", wrapper.classList.contains('toggled') ? 'toggled' : 'no toggled');
                    wrapper.classList.toggle('toggled');
                    console.log("Nuevo estado del wrapper.classList:", wrapper.classList.contains('toggled') ? 'toggled' : 'no toggled');
                }

                // Asignar el listener al botón de toggle
                if (sidebarToggle) {
                    sidebarToggle.addEventListener('click', toggleSidebar);
                    console.log("Listener para #sidebarToggle asignado.");
                } else {
                    console.error("Error: Elemento #sidebarToggle no encontrado. Asegúrese de que el ID es correcto en _mainLayout.html");
                }

                // Opcional: Cerrar el sidebar al hacer clic en un enlace del menú
                const sidebarLinks = document.querySelectorAll('#sidebar-wrapper .list-group-item');
                sidebarLinks.forEach(link => {
                    link.addEventListener('click', function(event) {
                        // Solo cierra el sidebar si está abierto y el clic no fue en el propio botón de toggle
                        if (wrapper.classList.contains('toggled')) {
                            // Comprobamos si el clic fue dentro del botón de toggle
                            const isClickOnToggle = sidebarToggle.contains(event.target) || event.target === sidebarToggle;
                            if (!isClickOnToggle) {
                                wrapper.classList.remove('toggled');
                                console.log("Sidebar cerrado al hacer clic en un enlace.");
                            }
                        }
                    });
                });

                console.log("Estado inicial del wrapper.classList:", wrapper.classList.contains('toggled') ? 'toggled' : 'no toggled');
            });
        </script>
        <!-- ¡Importante! Si usas Bootstrap JS para algo más, DEBERÍA ESTAR AQUÍ, después de tu JS personalizado.
             Pero para este diseño de sidebar, no es estrictamente necesario y podría causar conflictos. -->
        <!-- <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script> -->
        <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script> -->
    </body>
</html>
